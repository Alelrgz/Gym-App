{% from 'macros.html' import card %}

<!-- Create Exercise Modal -->
<div id="create-exercise-modal"
    class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    data-action="hideModal" data-target="create-exercise-modal">
    <div class="bg-[#1a1a1a] w-full max-w-md rounded-3xl p-6 border border-white/10 relative slide-up"
        onclick="event.stopPropagation()">
        <button onclick="hideModal('create-exercise-modal')"
            class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>

        <h2 id="new-ex-title" class="text-2xl font-bold mb-1" style=" color: rgb(211,47,47)">New Exercise</h2>
        <p class="text-sm text-gray-400 mb-6">Add a custom exercise to the database.</p>

        <div class="space-y-4">
            <div>
                <label class="text-xs text-gray-500 uppercase font-bold ml-1">Exercise Name</label>
                <input type="text" id="new-ex-name"
                    class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition"
                    placeholder="e.g. Bulgarian Split Squat">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs text-gray-500 uppercase font-bold ml-1">Muscle Group</label>
                    <select id="new-ex-muscle"
                        class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition">
                        <option>Chest</option>
                        <option>Back</option>
                        <option>Legs</option>
                        <option>Shoulders</option>
                        <option>Arms</option>
                        <option>Abs</option>
                        <option>Cardio</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-gray-500 uppercase font-bold ml-1">Type</label>
                    <select id="new-ex-type"
                        class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition">
                        <option>Compound</option>
                        <option>Isolation</option>
                        <option>Bodyweight</option>
                        <option>Cardio</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="text-xs text-gray-500 uppercase font-bold ml-1">Video (URL or File)</label>
                <div class="flex space-x-2">
                    <input type="text" id="new-ex-video"
                        class="flex-1 bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition"
                        placeholder="https://youtube.com/...">
                    <input type="file" id="new-ex-file" class="hidden" accept="video/*">
                    <button onclick="document.getElementById('new-ex-file').click()"
                        class="bg-white/10 hover:bg-white/20 text-white px-3 rounded-xl transition">
                        üìÅ
                    </button>
                </div>
                <p id="new-ex-filename" class="text-[10px] text-gray-500 mt-1 ml-1 truncate"></p>
                <div id="new-ex-preview-container" class="mt-2 hidden">
                    <video id="new-ex-preview" controls
                        class="w-full rounded-xl border border-white/10 bg-black max-h-40"></video>
                </div>
            </div>

            <button onclick="createExercise()"
                class="w-full bg-primary text-black font-bold py-4 rounded-xl hover:bg-primary/90 transition mt-4">
                Create Exercise
            </button>
        </div>
    </div>
</div>

<!-- Edit Exercise Modal -->
<div id="edit-exercise-modal"
    class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    data-action="hideModal" data-target="edit-exercise-modal">
    <div class="bg-[#1a1a1a] w-full max-w-md rounded-3xl p-6 border border-white/10 relative slide-up"
        onclick="event.stopPropagation()">
        <button onclick="hideModal('edit-exercise-modal')"
            class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>

        <h2 class="text-2xl font-bold mb-1 text-white">Edit Exercise</h2>
        <p class="text-sm text-gray-400 mb-6">Update exercise details.</p>

        <input type="hidden" id="edit-ex-id">

        <div class="space-y-4">
            <div>
                <label class="text-xs text-gray-500 uppercase font-bold ml-1">Exercise Name</label>
                <input type="text" id="edit-ex-name"
                    class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs text-gray-500 uppercase font-bold ml-1">Muscle Group</label>
                    <select id="edit-ex-muscle"
                        class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition">
                        <option>Chest</option>
                        <option>Back</option>
                        <option>Legs</option>
                        <option>Shoulders</option>
                        <option>Arms</option>
                        <option>Abs</option>
                        <option>Cardio</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs text-gray-500 uppercase font-bold ml-1">Type</label>
                    <select id="edit-ex-type"
                        class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition">
                        <option>Compound</option>
                        <option>Isolation</option>
                        <option>Bodyweight</option>
                        <option>Cardio</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="text-xs text-gray-500 uppercase font-bold ml-1">Video (URL or File)</label>
                <div class="flex space-x-2">
                    <input type="text" id="edit-ex-video"
                        class="flex-1 bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition"
                        placeholder="https://youtube.com/...">
                    <input type="file" id="edit-ex-file" class="hidden" accept="video/*">
                    <button onclick="document.getElementById('edit-ex-file').click()"
                        class="bg-white/10 hover:bg-white/20 text-white px-3 rounded-xl transition">
                        üìÅ
                    </button>
                </div>
                <p id="edit-ex-filename" class="text-[10px] text-gray-500 mt-1 ml-1 truncate"></p>
                <div id="edit-ex-preview-container" class="mt-2 hidden">
                    <video id="edit-ex-preview" controls
                        class="w-full rounded-xl border border-white/10 bg-black max-h-40"></video>
                </div>
            </div>

            <button onclick="updateExercise()"
                class="w-full bg-primary text-black font-bold py-4 rounded-xl hover:bg-primary/90 transition mt-4">
                Update Exercise
            </button>
        </div>
    </div>
</div>

<!-- Create Workout Modal -->
<div id="create-workout-modal"
    class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    data-action="hideModal" data-target="create-workout-modal">
    <div class="bg-[#1a1a1a] w-full max-w-md rounded-3xl p-6 border border-white/10 relative slide-up max-h-[85vh] overflow-y-auto"
        onclick="event.stopPropagation()">
        <button onclick="hideModal('create-workout-modal')"
            class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>

        <h2 id="modal-workout-title" class="text-2xl font-bold mb-1 text-white">New Workout</h2>
        <p class="text-sm text-gray-400 mb-6">Create a workout template.</p>

        <input type="hidden" id="new-workout-id">

        <div class="space-y-4">
            <div>
                <label class="text-xs text-gray-500 uppercase font-bold ml-1">Workout Title</label>
                <input type="text" id="new-workout-title"
                    class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition"
                    placeholder="e.g. Leg Day Destruction">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs text-gray-500 uppercase font-bold ml-1">Duration</label>
                    <input type="text" id="new-workout-duration"
                        class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition"
                        placeholder="e.g. 60 min">
                </div>
                <div>
                    <label class="text-xs text-gray-500 uppercase font-bold ml-1">Difficulty</label>
                    <select id="new-workout-difficulty"
                        class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition">
                        <option>Beginner</option>
                        <option>Intermediate</option>
                        <option>Advanced</option>
                        <option>Elite</option>
                    </select>
                </div>
            </div>

            <!-- Exercise Selection UI -->
            <div>
                <div class="flex justify-between items-center mb-2">
                    <label class="text-xs text-gray-500 uppercase font-bold ml-1">Selected Exercises</label>
                    <button data-action="showModal" data-target="create-exercise-modal"
                        class="text-xs bg-[#D32F2F] text-black font-bold px-3 py-1 rounded hover:bg-[#D32F2F]/80 transition">+
                        New Exercise</button>
                </div>

                <!-- New List-Based Selection -->
                <div class="bg-black/20 rounded-xl p-3 mb-4 border border-white/5">
                    <!-- Headers -->
                    <div
                        class="grid grid-cols-12 gap-2 mb-2 text-[10px] text-gray-500 font-bold uppercase tracking-wider text-center">
                        <div class="col-span-5 text-left pl-2">Exercise</div>
                        <div class="col-span-2">Sets</div>
                        <div class="col-span-2">Reps</div>
                        <div class="col-span-2">Rest</div>
                        <div class="col-span-1"></div>
                    </div>

                    <!-- List Container -->
                    <div id="selected-exercises-list" class="space-y-2 min-h-[50px]">
                        <p class="text-xs text-gray-500 text-center py-4 italic">No exercises selected.</p>
                    </div>
                </div>

                <label class="text-xs text-gray-500 uppercase font-bold ml-1 mb-2 block">Exercise Library</label>
                <div class="glass-card p-2 mb-2 flex flex-col gap-2">
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs">üîç</span>
                        <input type="text" id="ex-search" placeholder="Search exercises..."
                            class="w-full bg-black/20 border border-white/10 rounded-xl pl-8 pr-3 py-2 text-xs text-white outline-none focus:border-primary/50 transition placeholder-gray-500">
                    </div>
                    <div class="flex gap-2">
                        <select id="ex-filter-muscle"
                            class="w-1/2 bg-black/20 border border-white/10 rounded-xl px-3 py-2 text-xs text-white outline-none focus:border-primary/50 transition appearance-none cursor-pointer hover:bg-white/5">
                            <option value="">All Muscles</option>
                            <option value="Chest">Chest</option>
                            <option value="Back">Back</option>
                            <option value="Legs">Legs</option>
                            <option value="Shoulders">Shoulders</option>
                            <option value="Arms">Arms</option>
                            <option value="Abs">Abs</option>
                            <option value="Cardio">Cardio</option>
                        </select>
                        <select id="ex-filter-type"
                            class="w-1/2 bg-black/20 border border-white/10 rounded-xl px-3 py-2 text-xs text-white outline-none focus:border-primary/50 transition appearance-none cursor-pointer hover:bg-white/5">
                            <option value="">All Types</option>
                            <option value="Compound">Compound</option>
                            <option value="Isolation">Isolation</option>
                            <option value="Bodyweight">Bodyweight</option>
                            <option value="Cardio">Cardio</option>
                        </select>
                    </div>
                </div>

                <div id="exercise-library" class="grid grid-cols-1 gap-2 max-h-60 overflow-y-auto pr-1">
                    <!-- Populated by JS -->
                </div>
            </div>

            <button onclick="createWorkout()" id="btn-save-workout"
                class="w-full bg-primary text-black font-bold py-4 rounded-xl hover:bg-primary/90 transition mt-4">
                Create Workout
            </button>
        </div>
    </div>
</div>

<!-- Assign Workout Modal -->
<div id="assign-workout-modal"
    class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm"
    data-action="hideModal" data-target="assign-workout-modal">
    <div class="bg-[#1a1a1a] w-full max-w-sm rounded-3xl p-6 border border-white/10 relative slide-up"
        onclick="event.stopPropagation()">
        <button onclick="hideModal('assign-workout-modal')"
            class="absolute top-4 right-4 text-gray-400 hover:text-white">‚úï</button>

        <h2 class="text-xl font-bold mb-1 text-white">Assign Workout</h2>
        <p class="text-sm text-gray-400 mb-6" id="assign-modal-date">Select a workout to assign.</p>

        <input type="hidden" id="assign-client-id">
        <input type="hidden" id="assign-date">

        <div class="space-y-4">
            <div>
                <label class="text-xs text-gray-500 uppercase font-bold ml-1">Workout Template</label>
                <select id="assign-workout-select"
                    class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-primary outline-none transition">
                    <!-- Populated by JS -->
                </select>
            </div>

            <button onclick="assignWorkout()"
                class="w-full bg-primary text-black font-bold py-4 rounded-xl hover:bg-primary/90 transition mt-2">
                Assign to Client
            </button>
        </div>
    </div>
</div>

<div id="notification-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4"
    data-action="hideModal" data-target="notification-modal">
    {% call card(classes="w-full max-w-sm p-6 slide-up") %}
    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-lg text-white">Notifications</h3>
        <button data-action="hideModal" data-target="notification-modal" class="text-gray-400">‚úï</button>
    </div>
    <div class="space-y-3">
        <div class="flex items-start space-x-3 p-3 bg-white/5 rounded-xl">
            <span class="text-xl">üî•</span>
            <div>
                <p class="text-sm font-bold text-white">Streak Saver Used</p>
                <p class="text-xs text-gray-400">Yesterday</p>
            </div>
        </div>
        <div class="flex items-start space-x-3 p-3 bg-white/5 rounded-xl">
            <span class="text-xl">üèÜ</span>
            <div>
                <p class="text-sm font-bold text-white">Weekly Challenge</p>
                <p class="text-xs text-gray-400">You're in the top 10!</p>
            </div>
        </div>
    </div>
    {% endcall %}
</div>

<div id="shop-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4"
    data-action="hideModal" data-target="shop-modal">
    {% call card(classes="w-full max-w-sm p-6 slide-up") %}
    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-lg text-white">Gem Shop</h3>
        <button data-action="hideModal" data-target="shop-modal" class="text-gray-400">‚úï</button>
    </div>
    <div class="grid grid-cols-2 gap-3">
        <div class="bg-white/5 p-3 rounded-xl text-center tap-effect" data-action="showToast"
            data-message="Purchased! (Mock)">
            <div class="text-3xl mb-2">ü•§</div>
            <p class="text-xs font-bold text-white">Protein Shake</p>
            <p class="text-xs text-yellow-400">50 üíé</p>
        </div>
        <div class="bg-white/5 p-3 rounded-xl text-center tap-effect" data-action="showToast"
            data-message="Purchased! (Mock)">
            <div class="text-3xl mb-2">üëï</div>
            <p class="text-xs font-bold text-white">Gym Tee</p>
            <p class="text-xs text-yellow-400">500 üíé</p>
        </div>
    </div>
    {% endcall %}
</div>

<div id="profile-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4"
    data-action="hideModal" data-target="profile-modal">
    {% call card(classes="w-full max-w-sm p-6 slide-up") %}
    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-lg text-white">Settings</h3>
        <button data-action="hideModal" data-target="profile-modal" class="text-gray-400">‚úï</button>
    </div>
    <div class="space-y-4">
        <div class="flex justify-between items-center">
            <span class="text-sm text-gray-300">Dark Mode</span>
            <div class="w-10 h-6 bg-green-500 rounded-full relative">
                <div class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full"></div>
            </div>
        </div>
        <div class="flex justify-between items-center">
            <span class="text-sm text-gray-300">Notifications</span>
            <div class="w-10 h-6 bg-green-500 rounded-full relative">
                <div class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full"></div>
            </div>
        </div>
        <button class="w-full py-3 bg-red-500/20 text-red-400 font-bold rounded-xl mt-4">Log Out</button>
    </div>
    {% endcall %}
</div>

<div id="client-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4"
    data-action="hideModal" data-target="client-modal">
    {% call card(classes="w-full max-w-sm p-6 slide-up") %}
    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-lg text-white" id="modal-client-name">Client Details</h3>
        <button data-action="hideModal" data-target="client-modal" class="text-gray-400">‚úï</button>
    </div>
    <div class="space-y-4">
        <div class="bg-white/5 p-4 rounded-xl">
            <p class="text-xs text-gray-400 uppercase">Current Plan</p>
            <p class="text-lg font-bold text-white" id="modal-client-plan">...</p>
        </div>
        <div class="bg-white/5 p-4 rounded-xl">
            <p class="text-xs text-gray-400 uppercase">Status</p>
            <p class="text-lg font-bold text-white" id="modal-client-status">...</p>
        </div>
        <button class="w-full py-3 bg-white/10 text-white font-bold rounded-xl mb-2"
            onclick="openTrainerCalendar()">View Schedule</button>
        <button class="w-full py-3 bg-primary text-white font-bold rounded-xl">Message Client</button>
    </div>
    {% endcall %}

</div>

<div id="calendar-modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4"
    data-action="hideModal" data-target="calendar-modal">
    {% call card(classes="w-full max-w-md p-6 slide-up max-h-[80vh] overflow-y-auto", onclick="event.stopPropagation()")
    %}
    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-lg text-white">Client Schedule</h3>
        <button onclick="hideModal('calendar-modal')" class="text-gray-400">‚úï</button>
    </div>

    <!-- Calendar Header -->
    <div class="flex justify-between items-center mb-4">
        <button id="trainer-prev-month" class="p-2 bg-white/10 rounded-full tap-effect">‚Üê</button>
        <h2 id="trainer-month-year" class="text-xl font-bold text-white">December 2025</h2>
        <button id="trainer-next-month" class="p-2 bg-white/10 rounded-full tap-effect">‚Üí</button>
    </div>

    <!-- Calendar Grid -->
    <div class="grid grid-cols-7 gap-2 text-center mb-2">
        <div class="text-xs text-gray-500 font-bold">S</div>
        <div class="text-xs text-gray-500 font-bold">M</div>
        <div class="text-xs text-gray-500 font-bold">T</div>
        <div class="text-xs text-gray-500 font-bold">W</div>
        <div class="text-xs text-gray-500 font-bold">T</div>
        <div class="text-xs text-gray-500 font-bold">F</div>
        <div class="text-xs text-gray-500 font-bold">S</div>
    </div>
    <div id="trainer-calendar-grid" class="grid grid-cols-7 gap-y-2 gap-x-0">
        <!-- Days injected by JS -->
    </div>

    <!-- Selected Day Details -->
    <div id="trainer-day-details" class="space-y-3 mt-6">
        <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider ml-1" id="trainer-date-title">Select a day
        </h3>
        <div id="trainer-events-list" class="space-y-2"></div>
        <button id="add-workout-btn" class="w-full py-3 bg-white/10 text-white font-bold rounded-xl mt-2 hidden">+ Add
            Workout</button>
    </div>
    {% endcall %}
</div>